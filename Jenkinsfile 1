pipeline {
    agent any
    environment {
        // Define environment variables for the entire pipeline
        MAVEN_HOME = tool 'Maven'
        // You can define additional environment variables here
    }
    stages {
        stage('Build') {
            environment {
                // Define environment variables specific to this stage
                BUILD_VERSION = '1.0.0'
            }
            steps {
                echo 'Building the project'
                // Use the specified Maven installation to build your project
                sh "${MAVEN_HOME}/bin/mvn clean package -Dbuild.version=${BUILD_VERSION}"
            }
        }
        stage('Test') {
            steps {
                echo 'Running tests'
                // You can run your tests here
            }
        }
        stage('Deploy') {
            environment {
                // Define environment variables specific to this stage
                REMOTE_HOST = '18.118.195.70'
                REMOTE_USER = 'centos'
                WAR_FILE = "target/WebAppCal-0.0.6.war"
                REMOTE_DIR = "/home/centos"
            }
            steps {
                echo 'Deploying...'
                script {
                    // Use sshagent to securely copy the WAR file to the remote server
                    sshagent(['centos']) {
                        sh "scp -o StrictHostKeyChecking=no ${WORKSPACE}/${WAR_FILE} ${REMOTE_USER}@${REMOTE_HOST}:${REMOTE_DIR}"
                    }
                }
            }
        }
    }
    post {
        success {
            echo 'Pipeline succeeded. Add your success post-build actions here.'
        }
        failure {
            echo 'Pipeline failed. Add your failure post-build actions here.'
        }
    }
}
